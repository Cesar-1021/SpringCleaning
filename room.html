<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <script>
        let backgroundImage;
        let duster, sodaPile, laundryPile;
        let dust = [];
        let num = 4;
        let scaleFactor = 1;

        // Preload all images
        function preload() {
            backgroundImage = loadImage('sprites/room/room.png');
            duster = loadImage('sprites/room/dusterIRL.png');
            sodaPile = loadImage('sprites/room/sodaPile.png');
            laundryPile = loadImage('sprites/room/laundryPile.png');
            for (let i = 0; i < num; i++) {
                dust.push(loadImage('sprites/room/dust.png'));
            }
        }

        function setup() {
            updateScaleFactor();
            canvas = createCanvas(backgroundImage.width * scaleFactor, backgroundImage.height * scaleFactor);
            updateCanvasPosition();
        }

        function windowResized() {
            updateScaleFactor();
            resizeCanvas(backgroundImage.width * scaleFactor, backgroundImage.height * scaleFactor);
            updateCanvasPosition();
        }

        function updateScaleFactor() {
            let windowRatio = windowWidth / windowHeight;
            let imageRatio = backgroundImage.width / backgroundImage.height;
            if (windowRatio > imageRatio) {
                scaleFactor = windowHeight / backgroundImage.height;
            } else {
                scaleFactor = windowWidth / backgroundImage.width;
            }
        }

        function updateCanvasPosition() {
            let canvasX = (windowWidth - width) / 2;
            let canvasY = (windowHeight - height) / 2;
            canvas.position(canvasX, canvasY);
        }

        function draw() {
            clear();
            background(backgroundImage); // set the background every frame

            // Transformations and drawing scaled images
            push();
            translate((backgroundImage.width * scaleFactor) / 2 + 680 * scaleFactor, (backgroundImage.height * scaleFactor) / 2 + 180 * scaleFactor);
            rotate(PI * 1.1);
            image(duster, -duster.width / 8 * scaleFactor, -duster.height / 8 * scaleFactor, duster.width / 4 * scaleFactor, duster.height / 4 * scaleFactor);
            pop();

            image(sodaPile, (backgroundImage.width * scaleFactor) / 2 + 340 * scaleFactor, (backgroundImage.height * scaleFactor) / 2 + 120 * scaleFactor, sodaPile.width / 2.8 * scaleFactor, sodaPile.height / 2.8 * scaleFactor);
            image(laundryPile, (backgroundImage.width * scaleFactor) / 2 - 400 * scaleFactor, (backgroundImage.height * scaleFactor) / 2 - 80 * scaleFactor, laundryPile.width / 2 * scaleFactor, laundryPile.height / 2 * scaleFactor);
            for (let i = 0; i < num; i++) {
                image(dust[i], 0, 180 * scaleFactor + 138 * i * scaleFactor, 220 * scaleFactor, 125 * scaleFactor);
            }
        }

        // Update clickable areas or interactions based on scale
        function mouseClicked() {
            // Check for click on the dust piles
            let dustWidth = 220 * scaleFactor;
            let dustHeight = 125 * scaleFactor;
            let dustStartY = 180 * scaleFactor;
            let dustSpacing = 138 * scaleFactor;

            for (let i = 0; i < num; i++) {
                let pileY = dustStartY + i * dustSpacing;
                if (mouseX >= 0 && mouseX <= dustWidth && mouseY >= pileY && mouseY <= pileY + dustHeight) {
                    window.location.href = 'dust.html';
                    return;
                }
            }
        }
    </script>
</body>

</html>