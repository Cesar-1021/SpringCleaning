<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <script>
        let dusterCheck;
        if (dusterCheck === null) {
            localStorage.setItem('dusterCheck', '0');
        }
        dusterCheck = localStorage.getItem('dusterCheck');

        let hamperCheck;
        if (hamperCheck === null) {
            localStorage.setItem('hamperCheck', '0');
        }
        hamperCheck = localStorage.getItem('hamperCheck');

        // Reset
        // localStorage.setItem('hamperCheck', '0');
        // localStorage.setItem('dusterCheck', '0');

        let room;
        let dustImg, dusterImg, sodaImg, laundryImg, hamperImg;
        let dust, duster, soda, laundry, hamper;

        let num = 4;
        let refScale;

        // Preload all images
        function preload() {
            room = loadImage('sprites/room/room.png');
            dusterImg = loadImage('sprites/room/dusterIRL.png');
            hamperImg = loadImage('sprites/room/hamperIRL.png');
            sodaImg = loadImage('sprites/room/sodaPile.png');
            laundryImg = loadImage('sprites/room/laundryPile.png');
            dustImg = loadImage('sprites/room/dust.png');
        }

        function setup() {
            refScale = Math.min(windowWidth / room.width, windowHeight / room.height);

            let canvasX = (windowWidth / 2) - (room.width / 2) * refScale;
            let canvasY = (windowHeight / 2) - (room.height / 2) * refScale;
            width = room.width * refScale;
            height = room.height * refScale;
            calculatePositions();

            canvas = createCanvas(width, height).attribute('willReadFrequently', true);
            canvas.position(canvasX, canvasY);
        }

        function windowResized() {
            refScale = Math.min(windowWidth / room.width, windowHeight / room.height);
            let canvasX = (windowWidth / 2) - (room.width / 2) * refScale;
            let canvasY = (windowHeight / 2) - (room.height / 2) * refScale;
            width = room.width * refScale;
            height = room.height * refScale;
            resizeCanvas(width, height);
            calculatePositions();
            canvas.position(canvasX, canvasY);
        }

        function calculatePositions() {
            hamper = {
                left: 50 * refScale,
                right: 50 * refScale + hamperImg.width / 2.4 * refScale,
                top: height - 210 * refScale,
                bottom: height,
                width: hamperImg.width / 2.4 * refScale,
                height: hamperImg.height / 2.4 * refScale
            };

            laundry = {
                left: 450 * refScale,
                right: 450 * refScale + laundryImg.width / 2.7 * refScale,
                top: height - 400 * refScale,
                bottom: height,
                width: laundryImg.width / 2.7 * refScale,
                height: laundryImg.height / 2.7 * refScale
            };

            duster = {
                x: -90 * refScale,
                y: -170 * refScale,
                left: width - refScale * 150,
                right: width,
                top: height - 400 * refScale,
                bottom: height - 400 * refScale + 280 * refScale,
                width: dusterImg.width / 3.4 * refScale,
                height: dusterImg.height / 3.4 * refScale
            };

            dust = {
                left: 0,
                right: dustImg.width / 4.4 * refScale,
                top: 150 * refScale,
                bottom: (555 + dustImg.height / 3) * refScale,
                width: dustImg.width / 4.4 * refScale,
                height: dustImg.height / 3 * refScale
            };

            soda = {
                left: width - 550 * refScale,
                right: width - 550 * refScale + sodaImg.width,
                top: height - 340 * refScale,
                bottom: height - 340 * refScale + sodaImg.height,
                width: sodaImg.width / 3.5 * refScale,
                height: sodaImg.height / 3.5 * refScale
            };
        }

        function draw() {
            clear();
            background(room); // set the background every frame

            let mouseOverDuster = mouseX >= duster.left && mouseX <= duster.right && mouseY >= duster.top && mouseY <= duster.bottom;
            let mouseOverDust = mouseX >= dust.left && mouseX <= dust.right && mouseY >= dust.top && mouseY <= dust.bottom;
            let mouseOverHamper = mouseX >= hamper.left && mouseX <= hamper.right && mouseY >= hamper.top && mouseY <= hamper.bottom;
            let mouseOverLaundry = mouseX >= laundry.left && mouseX <= laundry.right && mouseY >= laundry.top && mouseY <= laundry.bottom;

            if (dusterCheck != '2') {
                if (dusterCheck === '0') {
                    if (mouseX >= duster.left && mouseX <= duster.right && mouseY >= duster.top && mouseY <= duster.bottom) {
                        tint(192, 255, 172);
                    }
                    // Transformations and drawing scaled images
                    push();
                    translate(width / 2 + 680 * refScale, height / 2 + 180 * refScale);
                    rotate(PI * 1.1);
                    image(dusterImg, duster.x, duster.y, duster.width, duster.height);
                    pop();
                    // square(width - refScale * 150, height - 700 * refScale, 150 * refScale);
                    tint('none');
                    image(sodaImg, soda.left, soda.top, soda.width, soda.height);
                }
                if (mouseX >= dust.left && mouseX <= dust.right && mouseY >= dust.top && mouseY <= dust.bottom) {
                    tint(192, 255, 172);
                }
                for (let i = 0; i < num; i++) {
                    image(dustImg, -5, dust.top + i * 135 * refScale, dust.width, dust.height);
                }
                tint('none');
            }

            if (hamperCheck != '2') {
                if (hamperCheck === '0') {
                    if (mouseX >= hamper.left && mouseX <= hamper.right && mouseY >= hamper.top && mouseY <= hamper.bottom) {
                        tint(192, 255, 172);
                    }
                    image(hamperImg, hamper.left, hamper.top, hamper.width, hamper.height);
                }
                tint('none');
                if (mouseX >= laundry.left && mouseX <= laundry.right && mouseY >= laundry.top && mouseY <= laundry.bottom) {
                    tint(192, 255, 172);
                }
                image(laundryImg, laundry.left, laundry.top, laundry.width, laundry.height);
                tint('none');
            }

            // Set cursor
            cursor(mouseOverDust && dusterCheck != '2' ||
                mouseOverDuster && dusterCheck === '0' ||
                mouseOverHamper && hamperCheck === '0' ||
                mouseOverLaundry && hamperCheck != '2' ? HAND : ARROW);
        }

        // Update clickable areas or interactions based on scale
        function mouseClicked() {
            if (dusterCheck != '2') {
                if (mouseX >= dust.left && mouseX <= dust.right && mouseY >= dust.top && mouseY <= dust.bottom) {
                    window.location.href = 'dust.html';
                }
            }

            if (dusterCheck === '0') {
                if (mouseX >= duster.left && mouseX <= duster.right && mouseY >= duster.top && mouseY <= duster.bottom) {
                    window.location.href = 'duster.html';
                }
            }

            if (hamperCheck != '2') {
                if (mouseX >= laundry.left && mouseX <= laundry.right && mouseY >= laundry.top && mouseY <= laundry.bottom) {
                    window.location.href = 'laundry.html';
                }
            }

            if (hamperCheck === '0') {
                if (mouseX >= hamper.left && mouseX <= hamper.right && mouseY >= hamper.top && mouseY <= hamper.bottom) {
                    window.location.href = 'hamper.html';
                }
            }
        }
    </script>
</body>

</html>