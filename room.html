<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <script>
        let dusterCheck;
        if (dusterCheck === null) {
            localStorage.setItem('dusterCheck', '0');
        }
        dusterCheck = localStorage.getItem('dusterCheck');

        let hamperCheck;
        if (hamperCheck === null) {
            localStorage.setItem('hamperCheck', '0');
        }
        hamperCheck = localStorage.getItem('hamperCheck');

        // Reset
        // localStorage.setItem('hamperCheck', '0');
        // localStorage.setItem('dusterCheck', '0');

        let room;
        let duster, sodaPile, laundryPile, hamper;
        let dust = [];
        let num = 4;
        let refScale;

        // Preload all images
        function preload() {
            room = loadImage('sprites/room/room.png');
            duster = loadImage('sprites/room/dusterIRL.png');
            hamper = loadImage('sprites/room/hamperIRL.png');
            sodaPile = loadImage('sprites/room/sodaPile.png');
            laundryPile = loadImage('sprites/room/laundryPile.png');
            for (let i = 0; i < num; i++) {
                dust.push(loadImage('sprites/room/dust.png'));
            }
        }

        function setup() {
            refScale = Math.min(windowWidth / room.width, windowHeight / room.height);

            let canvasX = (windowWidth / 2) - (room.width / 2) * refScale;
            let canvasY = (windowHeight / 2) - (room.height / 2) * refScale;
            width = room.width * refScale;
            height = room.height * refScale;

            canvas = createCanvas(width, height);
            canvas.position(canvasX, canvasY);
        }

        function windowResized() {
            refScale = Math.min(windowWidth / room.width, windowHeight / room.height);
            let canvasX = (windowWidth / 2) - (room.width / 2) * refScale;
            let canvasY = (windowHeight / 2) - (room.height / 2) * refScale;
            width = room.width * refScale;
            height = room.height * refScale;

            resizeCanvas(width, height);
            canvas.position(canvasX, canvasY);
        }

        function draw() {
            clear();
            background(room); // set the background every frame

            // Transformations and drawing scaled images
            push();
            translate(width / 2 + 680 * refScale, height / 2 + 180 * refScale);
            rotate(PI * 1.1);
            image(duster, -90 * refScale, -170 * refScale, duster.width / 3.4 * refScale, duster.height / 3.4 * refScale);
            pop();
            // square(width - refScale * 150, height - 700 * refScale, 150 * refScale);

            image(sodaPile, width - 550 * refScale, height - 340 * refScale, sodaPile.width / 3.5 * refScale, sodaPile.height / 3.5 * refScale);
            image(laundryPile, 450 * refScale, height - 400 * refScale, laundryPile.width / 2.7 * refScale, laundryPile.height / 2.7 * refScale);
            image(hamper, 50 * refScale, height - 210 * refScale, hamper.width / 2.4 * refScale, hamper.height / 2.4 * refScale);

            for (let i = 0; i < num; i++) {
                image(dust[i], -5, 150 * refScale + i * 135 * refScale, dust[i].width / 4.4 * refScale, dust[i].height / 3 * refScale);
            }
        }

        // Update clickable areas or interactions based on scale
        function mouseClicked() {
            if (dusterCheck != '2') {
                dustLeft = 0;
                dustRight = dust[0].width / 4.4 * refScale;
                dustTop = 150 * refScale;
                dustBottom = 150 * refScale + 3 * 135 * refScale + dust[0].height / 3 * refScale;

                if (mouseX >= dustLeft && mouseX <= dustRight && mouseY >= dustTop && mouseY <= dustBottom) {
                    window.location.href = 'dust.html';
                }
            }

            if (dusterCheck === '0') {
                dusterLeft = width - refScale * 150;
                dusterRight = width;
                dusterTop = height - 400 * refScale;
                dusterBottom = height - 400 * refScale + 280 * refScale;
                if (mouseX >= dusterLeft && mouseX <= dusterRight && mouseY >= dusterTop && mouseY <= dusterBottom) {
                    window.location.href = 'duster.html';
                }
            }

            if (hamperCheck === '0') {
                hamperLeft = 50 * refScale;
                hamperRight = 50 * refScale + hamper.width / 2.4 * refScale;
                hamperTop = height - 210 * refScale;
                hamperBottom = height;
                if (mouseX >= hamperLeft && mouseX <= hamperRight && mouseY >= hamperTop && mouseY <= hamperBottom) {
                    window.location.href = 'hamper.html';
                }
            }
        }
    </script>
</body>

</html>