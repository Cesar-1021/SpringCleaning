<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dirty Laundry</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        #returnButton {
            display: none;
            position: fixed;
            top: 80%;
            left: 50%;
            transform: translate(-50%);
            padding: 2vmin;
            font-size: 5vmin;
            color: white;
            background-color: black;
            border: none;
            border-radius: 3vmin;
            cursor: pointer;
            z-index: 1000;
        }

        #returnButton:hover {
            background-color: pink;
        }
    </style>
</head>

<body>
    <button id="returnButton">Return to Room</button>
    <script>
        var sodaCheck = localStorage.getItem('sodaCheck');

        let circus;
        let defaultSoda, sodaImg, recycle, recycleImg, cannon, cannonImg;
        let sodas = [];

        let gravity;
        let refScale;
        let width;
        let height;

        // Preload all images
        function preload() {
            sodaImg = loadImage('sprites/enemies/soda.png');
            recycleImg = loadImage('sprites/room/recyclingBin.png');
            cannonImg = loadImage('sprites/miniGames/cannon.png');
            circus = loadImage('sprites/miniGames/circus.png');
        }

        function setup() {
            frameRate(60);

            refScale = Math.min(windowWidth / circus.width, windowHeight / circus.height);

            let canvasX = (windowWidth / 2) - (circus.width / 2) * refScale;
            let canvasY = (windowHeight / 2) - (circus.height / 2) * refScale;
            width = circus.width * refScale;
            height = circus.height * refScale;

            canvas = createCanvas(width, height);
            canvas.position(canvasX, canvasY);

            calculatePositions()

            mouseX = windowWidth / 2;
            mouseY = windowHeight / 2;
        }

        function windowResized() {
            refScale = Math.min(windowWidth / circus.width, windowHeight / circus.height);
            let canvasX = (windowWidth / 2) - (circus.width / 2) * refScale;
            let canvasY = (windowHeight / 2) - (circus.height / 2) * refScale;
            width = circus.width * refScale;
            height = circus.height * refScale;

            resizeCanvas(width, height);
            calculatePositions()
            canvas.position(canvasX, canvasY);
        }

        function calculatePositions() {
            gravity = 0.5 * refScale;
            maxPowerX = 19 * refScale;
            maxPowerY = 29 * refScale;

            recycle = {
                left: width - 680 * refScale,
                top: 710 * refScale,
                width: recycleImg.width / 3.5 * refScale,
                height: recycleImg.height / 3.5 * refScale
            };
            recycle.left = width / 2 - recycle.width / 2;
            recycle.right = recycle.left + recycle.width;
            recycle.bottom = recycle.top + recycle.height;

            cannon = {
                left: width / 2,
                top: height / 2 - 90 * refScale,
                width: cannonImg.width / 6 * refScale,
                height: cannonImg.height / 6 * refScale,
                velocityX: 0
            };
            cannon.left = width / 2 - cannon.width / 2;
            cannon.right = cannon.left + cannon.width;
            cannon.bottom = cannon.top + cannon.height;

            defaultSoda = {
                left: width - 680 * refScale,
                top: 270 * refScale,
                width: sodaImg.width / 5 * refScale,
                height: sodaImg.height / 5 * refScale
            };
            defaultSoda.right = defaultSoda.left + defaultSoda.width;
            defaultSoda.bottom = defaultSoda.top + defaultSoda.height;

            for (let i = 0; i < 10; i++) {
                sodas[i] = {
                    left: width - 680 * refScale,
                    top: 270 * refScale,
                    width: sodaImg.width / 5 * refScale,
                    height: sodaImg.height / 5 * refScale,
                    velocityX: 0,
                    velocityY: 0
                };
                sodas[i].right = sodas[i].left + sodas[i].width;
                sodas[i].bottom = sodas[i].top + sodas[i].height;
            }
        }

        function draw() {
            background(circus); // set the background every frame
            image(recycleImg, mouseX - recycle.width / 2, recycle.top, recycle.width, recycle.height);
            image(sodaImg, defaultSoda.left, defaultSoda.top, defaultSoda.width, defaultSoda.height);
            image(cannonImg, cannon.left, cannon.top, cannon.width, cannon.height);



            sodas.forEach(soda => {
                if (soda.y > height) {
                    // Math.random() * (max - min) + min;
                    soda.left = Math.floor(Math.random() * ((width - soda.width) - 0) + 0);
                    soda.top = -soda.height;
                }
                sock.left += sock.velocityX;
                sock.right = sock.left + sock.width;
                sock.top += sock.velocityY;
                sock.bottom = sock.top + sock.height;
            })
        }

        function styledText(string, x, y) {
            stroke(0, 0, 0);
            strokeWeight(5);
            sizeOfText = 130 * refScale;
            textSize(sizeOfText);
            textStyle(BOLD);
            textAlign(CENTER);
            textFont('Papyrus');
            fill(255);
            text(string, x, y);
        }

    </script>
</body>

</html>